define ("realtimeplugin_phppoll/realtime",["core/pubsub","tool_realtime/events"],function(a,b){var c,d=[],e,f=function(){var c=new Date,e=c.getTime();d.push(e);d=d.slice(-10);if(10<=d.length&&5e3>e-d[0]){a.publish(b.CONNECTION_LOST);return!1}return!0},g=function(){if(!f()){return}var d=new XMLHttpRequest,h;d.onreadystatechange=function(){if(4===this.readyState&&200===this.status){if(200===this.status){try{h=JSON.parse(this.responseText)}catch(a){setTimeout(g,c.timeout);return}if(!h.success||1!==h.success){return}var d=h.events;for(var e in d){a.publish(b.EVENT,d[e]);c.fromid=d[e].id}setTimeout(g,c.timeout)}else{setTimeout(g,c.timeout)}}};var i=e+"?userid="+encodeURIComponent(c.userid)+"&token="+encodeURIComponent(c.token)+"&fromid="+encodeURIComponent(c.fromid);d.open("GET",i,!0);d.send()};return{init:function init(a,b,d,f,h){if(c&&c.userid){return}c={userid:a,token:b,fromid:d,timeout:h};e=f;setTimeout(g,h)}}});
//# sourceMappingURL=realtime.min.js.map
