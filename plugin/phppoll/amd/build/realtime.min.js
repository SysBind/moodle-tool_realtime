define ("realtimeplugin_phppoll/realtime",["core/pubsub","tool_realtime/events","jquery"],function(a,b,c){var d,e=[],f,g=function(){var c=new Date,d=c.getTime();e.push(d);e=e.slice(-10);if(10<=e.length&&5e3>d-e[0]){a.publish(b.CONNECTION_LOST);return!1}return!0},h=function(){c("#realtimeresults").append("Starting to poll<br>\n");if(!g()){return}var e=new XMLHttpRequest,j;e.onreadystatechange=function(){c("#realtimeresults").append("== readyState="+this.readyState+", status="+this.status+", responsetext="+this.responseText+"<br>\n");if(4===this.readyState&&200===this.status){if(200===this.status){try{j=JSON.parse(this.responseText)}catch(a){h();return}if(!j.success||1!==j.success){return}var e=j.events;for(var f in e){a.publish(b.EVENT,e[f]);d.fromid=e[f].id}h()}else{h()}}};var k=f+"?userid="+encodeURIComponent(d.userid)+"&token="+encodeURIComponent(d.token)+"&fromid="+encodeURIComponent(d.fromid);e.open("GET",k,!0);e.send()};return{init:function init(a,b,c,e){if(d&&d.userid){return}d={userid:a,token:b,fromid:c};f=e;setTimeout(h,100)}}});
//# sourceMappingURL=realtime.min.js.map
